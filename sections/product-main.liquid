<section class="product-main">
  <div class="container">
    <div class="product__layout">
      <!-- Product Media -->
      <div class="product__media">
        <div class="product__gallery">
          {% if product.media.size > 0 %}
            <div class="product__gallery-main">
              <div class="product__image-container">
                {% assign featured_media = product.selected_or_first_available_variant.featured_media | default: product.featured_media %}
                <img 
                  src="{{ featured_media | image_url: width: 800 }}" 
                  alt="{{ featured_media.alt | escape }}"
                  loading="eager"
                  width="800"
                  height="{{ 800 | divided_by: featured_media.aspect_ratio }}"
                  class="product__image active"
                  id="main-product-image"
                >
                
                {% if product.media.size > 1 %}
                  {% for media in product.media offset: 1 %}
                    {% if media.media_type == 'image' %}
                      <img 
                        src="{{ media | image_url: width: 800 }}" 
                        alt="{{ media.alt | escape }}"
                        loading="lazy"
                        width="800"
                        height="{{ 800 | divided_by: media.aspect_ratio }}"
                        class="product__image"
                        style="display: none;"
                      >
                    {% endif %}
                  {% endfor %}
                {% endif %}
              </div>
            </div>
            
            {% if product.media.size > 1 %}
              <div class="product__thumbnails">
                {% for media in product.media %}
                  {% if media.media_type == 'image' %}
                    <button 
                      class="product__thumbnail{% if forloop.first %} active{% endif %}"
                      data-media-id="{{ media.id }}"
                      aria-label="View image {{ forloop.index }}"
                    >
                      <img 
                        src="{{ media | image_url: width: 200 }}" 
                        alt="{{ media.alt | escape }}"
                        loading="lazy"
                        width="200"
                        height="{{ 200 | divided_by: media.aspect_ratio }}"
                      >
                    </button>
                  {% endif %}
                {% endfor %}
              </div>
            {% endif %}
          {% else %}
            <div class="product__placeholder">
              {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Product Information -->
      <div class="product__info">
        <div class="product__header">
          {% if product.vendor and section.settings.show_vendor %}
            <p class="product__vendor">{{ product.vendor }}</p>
          {% endif %}
          
          <h1 class="product__title">{{ product.title }}</h1>
          
          <div class="product__price">
            <span class="price{% if product.compare_at_price > product.price %} price--sale{% endif %}">
              {{ product.price | money }}
            </span>
            {% if product.compare_at_price > product.price %}
              <span class="price price--compare">{{ product.compare_at_price | money }}</span>
              <span class="price-badge">
                Save {{ product.compare_at_price | minus: product.price | money }}
              </span>
            {% endif %}
          </div>
          
          {% if section.settings.show_rating and product.metafields.reviews.rating.value %}
            <div class="product__rating">
              <div class="rating">
                <div class="rating__stars" style="--rating: {{ product.metafields.reviews.rating.value }}">
                  ★★★★★
                </div>
                <span class="rating__count">({{ product.metafields.reviews.rating_count }} reviews)</span>
              </div>
            </div>
          {% endif %}
        </div>

        {% if product.description != blank %}
          <div class="product__description">
            {{ product.description }}
          </div>
        {% endif %}

        <!-- Product Form -->
        <form action="/cart/add" method="post" enctype="multipart/form-data" class="product__form">
          {% unless product.has_only_default_variant %}
            <div class="product__variants">
              {% for option in product.options_with_values %}
                <div class="product__option">
                  <label class="product__option-label">{{ option.name }}</label>
                  
                  {% if option.name == 'Color' or option.name == 'Colour' %}
                    <div class="variant-selector variant-selector--color">
                      {% for value in option.values %}
                        <input 
                          type="radio" 
                          name="options[{{ option.name | escape }}]" 
                          value="{{ value | escape }}" 
                          id="option-{{ option.position }}-{{ forloop.index0 }}"
                          {% if option.selected_value == value %}checked{% endif %}
                          class="variant-selector__input"
                        >
                        <label 
                          for="option-{{ option.position }}-{{ forloop.index0 }}" 
                          class="variant-selector__label variant-selector__label--color"
                          title="{{ value }}"
                        >
                          {{ value }}
                        </label>
                      {% endfor %}
                    </div>
                  {% elsif option.name == 'Size' %}
                    <div class="variant-selector variant-selector--size">
                      {% for value in option.values %}
                        <input 
                          type="radio" 
                          name="options[{{ option.name | escape }}]" 
                          value="{{ value | escape }}" 
                          id="option-{{ option.position }}-{{ forloop.index0 }}"
                          {% if option.selected_value == value %}checked{% endif %}
                          class="variant-selector__input"
                        >
                        <label 
                          for="option-{{ option.position }}-{{ forloop.index0 }}" 
                          class="variant-selector__label variant-selector__label--size"
                        >
                          {{ value }}
                        </label>
                      {% endfor %}
                    </div>
                    {% if section.settings.show_size_guide %}
                      <button type="button" class="size-guide-trigger">Size Guide</button>
                    {% endif %}
                  {% else %}
                    <select name="options[{{ option.name | escape }}]" class="product__select">
                      {% for value in option.values %}
                        <option value="{{ value | escape }}" {% if option.selected_value == value %}selected{% endif %}>
                          {{ value }}
                        </option>
                      {% endfor %}
                    </select>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          {% endunless %}

          <div class="product__quantity">
            <label for="quantity" class="product__quantity-label">Quantity</label>
            <div class="quantity-selector">
              <button type="button" class="quantity-selector__button" data-action="decrease">-</button>
              <input 
                type="number" 
                name="quantity" 
                id="quantity" 
                value="1" 
                min="1" 
                class="quantity-selector__input"
              >
              <button type="button" class="quantity-selector__button" data-action="increase">+</button>
            </div>
          </div>

          <div class="product__actions">
            <button 
              type="submit" 
              name="add" 
              class="btn btn--accent product__add-to-cart"
              {% unless product.available %}disabled{% endunless %}
            >
              {% if product.available %}
                Add to Cart
              {% else %}
                Sold Out
              {% endif %}
            </button>
            
            <button type="button" class="btn btn--secondary product__wishlist">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M10 18.35L8.55 17.03C3.4 12.36 0 9.27 0 5.5C0 2.42 2.42 0 5.5 0C7.24 0 8.91 0.81 10 2.08C11.09 0.81 12.76 0 14.5 0C17.58 0 20 2.42 20 5.5C20 9.27 16.6 12.36 11.45 17.04L10 18.35Z" fill="currentColor"/>
              </svg>
              Save
            </button>
          </div>

          <select name="id" style="display: none;">
            {% for variant in product.variants %}
              <option 
                value="{{ variant.id }}" 
                {% if variant == product.selected_or_first_available_variant %}selected{% endif %}
                data-available="{{ variant.available }}"
                data-price="{{ variant.price }}"
                data-compare-price="{{ variant.compare_at_price }}"
              >
                {{ variant.title }}
              </option>
            {% endfor %}
          </select>
        </form>

        <!-- Product Features -->
        {% if section.settings.show_features %}
          <div class="product__features">
            <div class="feature">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M21 16V8C21 6.9 20.1 6 19 6H5C3.9 6 3 6.9 3 8V16C3 17.1 3.9 18 5 18H19C20.1 18 21 17.1 21 16Z" stroke="currentColor" stroke-width="2"/>
                <path d="M7 6V4C7 2.9 7.9 2 9 2H15C16.1 2 17 2.9 17 4V6" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>Free shipping on orders over $75</span>
            </div>
            <div class="feature">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>30-day easy returns</span>
            </div>
            <div class="feature">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
                <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2"/>
              </svg>
              <span>Premium quality materials</span>
            </div>
          </div>
        {% endif %}

        <!-- Social Share -->
        {% if section.settings.show_share_buttons %}
          <div class="product__share">
            <span class="product__share-label">Share:</span>
            <div class="social-share">
              <a href="https://www.facebook.com/sharer.php?u={{ shop.url }}{{ product.url }}" target="_blank" rel="noopener" aria-label="Share on Facebook">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
              </a>
              <a href="https://twitter.com/intent/tweet?text={{ product.title | url_encode }}&url={{ shop.url }}{{ product.url }}" target="_blank" rel="noopener" aria-label="Share on Twitter">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                </svg>
              </a>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

<!-- Related Products -->
{% if section.settings.show_related_products and product.related_products.size > 0 %}
  <section class="related-products section-padding">
    <div class="container">
      <div class="section-header text-center mb-xl">
        <h2 class="section-heading">You might also like</h2>
      </div>
      
      <div class="product-grid grid grid--4-col">
        {% for related_product in product.related_products limit: 4 %}
          <div class="product-card">
            <div class="product-card__media">
              <a href="{{ related_product.url }}" class="product-card__link">
                {% if related_product.featured_media %}
                  <img 
                    src="{{ related_product.featured_media | image_url: width: 600 }}" 
                    alt="{{ related_product.featured_media.alt | escape }}"
                    loading="lazy"
                    width="600"
                    height="{{ 600 | divided_by: related_product.featured_media.aspect_ratio }}"
                    class="product-card__image"
                  >
                {% else %}
                  <div class="product-card__placeholder">
                    {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                  </div>
                {% endif %}
              </a>
            </div>
            
            <div class="product-card__content">
              <h3 class="product-card__title">
                <a href="{{ related_product.url }}">{{ related_product.title }}</a>
              </h3>
              <div class="product-card__price">
                <span class="price">{{ related_product.price | money }}</span>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
{% endif %}

{% stylesheet %}
  .product-main {
    padding: var(--spacing-xl) 0;
  }

  .product__layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-xxl);
    align-items: start;
  }

  /* Product Media */
  .product__media {
    position: sticky;
    top: calc(var(--header-height) + var(--spacing-lg));
  }

  .product__gallery-main {
    margin-bottom: var(--spacing-lg);
  }

  .product__image-container {
    position: relative;
    aspect-ratio: 1;
    border-radius: var(--radius-large);
    overflow: hidden;
    background-color: var(--color-border);
  }

  .product__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: var(--transition-fast);
  }

  .product__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: var(--color-border);
  }

  .product__thumbnails {
    display: flex;
    gap: var(--spacing-sm);
    overflow-x: auto;
    padding-bottom: var(--spacing-xs);
  }

  .product__thumbnail {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    border: 2px solid transparent;
    border-radius: var(--radius-medium);
    overflow: hidden;
    background: none;
    cursor: pointer;
    transition: var(--transition-fast);
  }

  .product__thumbnail.active {
    border-color: var(--color-accent);
  }

  .product__thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Product Info */
  .product__info {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
  }

  .product__vendor {
    font-size: 0.875rem;
    color: var(--color-text-light);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--spacing-xs);
  }

  .product__title {
    font-size: clamp(1.5rem, 4vw, 2.5rem);
    line-height: 1.2;
    margin-bottom: var(--spacing-sm);
  }

  .product__price {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-sm);
  }

  .price {
    font-size: 1.5rem;
    font-weight: 600;
  }

  .price--sale {
    color: var(--color-accent);
  }

  .price--compare {
    font-size: 1.25rem;
    color: var(--color-text-light);
    text-decoration: line-through;
    font-weight: 400;
  }

  .price-badge {
    background-color: var(--color-accent);
    color: white;
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--radius-small);
    font-size: 0.875rem;
    font-weight: 600;
  }

  .product__rating {
    margin-bottom: var(--spacing-sm);
  }

  .rating {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
  }

  .rating__stars {
    color: #ffd700;
    position: relative;
    display: inline-block;
    font-size: 1.125rem;
  }

  .rating__count {
    color: var(--color-text-light);
  }

  .product__description {
    line-height: 1.6;
    color: var(--color-text-light);
  }

  /* Product Form */
  .product__form {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
  }

  .product__option {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .product__option-label {
    font-weight: 600;
    font-size: 1rem;
  }

  /* Variant Selectors */
  .variant-selector {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
  }

  .variant-selector__input {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  .variant-selector__label {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-small);
    background-color: var(--color-background);
    cursor: pointer;
    transition: var(--transition-fast);
    text-align: center;
    min-width: 44px;
    font-weight: 500;
  }

  .variant-selector__label--size {
    min-width: 60px;
  }

  .variant-selector__label:hover {
    border-color: var(--color-text);
  }

  .variant-selector__input:checked + .variant-selector__label {
    border-color: var(--color-accent);
    background-color: var(--color-accent);
    color: white;
  }

  .variant-selector__input:disabled + .variant-selector__label {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .size-guide-trigger {
    background: none;
    border: none;
    color: var(--color-accent);
    text-decoration: underline;
    cursor: pointer;
    font-size: 0.875rem;
    padding: 0;
    margin-top: var(--spacing-xs);
  }

  .product__select {
    padding: var(--spacing-sm);
    border: 2px solid var(--color-border);
    border-radius: var(--radius-small);
    background-color: var(--color-background);
    font-size: 1rem;
  }

  /* Quantity Selector */
  .product__quantity {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .product__quantity-label {
    font-weight: 600;
  }

  .quantity-selector {
    display: flex;
    align-items: center;
    width: fit-content;
    border: 2px solid var(--color-border);
    border-radius: var(--radius-small);
    overflow: hidden;
  }

  .quantity-selector__button {
    width: 44px;
    height: 44px;
    border: none;
    background-color: var(--color-background);
    cursor: pointer;
    font-size: 1.125rem;
    font-weight: 600;
    transition: var(--transition-fast);
  }

  .quantity-selector__button:hover {
    background-color: var(--color-border);
  }

  .quantity-selector__input {
    width: 60px;
    height: 44px;
    border: none;
    text-align: center;
    font-size: 1rem;
    font-weight: 600;
    background-color: var(--color-background);
  }

  /* Product Actions */
  .product__actions {
    display: flex;
    gap: var(--spacing-sm);
  }

  .product__add-to-cart {
    flex: 1;
    min-height: 52px;
    font-size: 1rem;
    font-weight: 600;
  }

  .product__wishlist {
    min-width: 52px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Product Features */
  .product__features {
    border-top: 1px solid var(--color-border);
    padding-top: var(--spacing-lg);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }

  .feature {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 0.875rem;
    color: var(--color-text-light);
  }

  .feature svg {
    color: var(--color-accent);
    flex-shrink: 0;
  }

  /* Social Share */
  .product__share {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--color-border);
  }

  .product__share-label {
    font-weight: 600;
    color: var(--color-text-light);
  }

  .social-share {
    display: flex;
    gap: var(--spacing-xs);
  }

  .social-share a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-small);
    color: var(--color-text-light);
    transition: var(--transition-fast);
  }

  .social-share a:hover {
    background-color: var(--color-accent);
    border-color: var(--color-accent);
    color: white;
  }

  /* Related Products */
  .related-products {
    border-top: 1px solid var(--color-border);
  }

  /* Responsive Design */
  @media (max-width: 1024px) {
    .product__layout {
      gap: var(--spacing-xl);
    }
  }

  @media (max-width: 768px) {
    .product__layout {
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }

    .product__media {
      position: static;
    }

    .product__actions {
      flex-direction: column;
    }

    .product__wishlist {
      min-width: auto;
    }

    .product__features {
      gap: var(--spacing-sm);
    }

    .product__share {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--spacing-sm);
    }
  }

  @media (max-width: 480px) {
    .product-main {
      padding: var(--spacing-lg) 0;
    }

    .variant-selector {
      gap: var(--spacing-xs);
    }

    .variant-selector__label {
      padding: var(--spacing-xs) var(--spacing-sm);
      min-width: 40px;
    }

    .quantity-selector__button,
    .quantity-selector__input {
      height: 40px;
    }

    .quantity-selector__button {
      width: 40px;
    }

    .quantity-selector__input {
      width: 50px;
    }
  }
{% endstylesheet %}

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Product image gallery
    const thumbnails = document.querySelectorAll('.product__thumbnail');
    const mainImages = document.querySelectorAll('.product__image');
    
    thumbnails.forEach((thumbnail, index) => {
      thumbnail.addEventListener('click', function() {
        // Remove active class from all thumbnails and images
        thumbnails.forEach(t => t.classList.remove('active'));
        mainImages.forEach(img => {
          img.style.display = 'none';
          img.classList.remove('active');
        });
        
        // Add active class to clicked thumbnail and corresponding image
        this.classList.add('active');
        if (mainImages[index]) {
          mainImages[index].style.display = 'block';
          mainImages[index].classList.add('active');
        }
      });
    });

    // Quantity selectors
    const quantityButtons = document.querySelectorAll('.quantity-selector__button');
    const quantityInput = document.querySelector('.quantity-selector__input');
    
    quantityButtons.forEach(button => {
      button.addEventListener('click', function() {
        const action = this.dataset.action;
        let currentValue = parseInt(quantityInput.value);
        
        if (action === 'increase') {
          quantityInput.value = currentValue + 1;
        } else if (action === 'decrease' && currentValue > 1) {
          quantityInput.value = currentValue - 1;
        }
      });
    });

    // Variant selection
    const variantInputs = document.querySelectorAll('.variant-selector__input');
    const variantSelect = document.querySelector('select[name="id"]');
    const priceElements = document.querySelectorAll('.price');
    const addToCartButton = document.querySelector('.product__add-to-cart');
    
    function updateVariant() {
      const selectedOptions = [];
      
      variantInputs.forEach(input => {
        if (input.checked) {
          selectedOptions.push(input.value);
        }
      });
      
      // Find matching variant
      const variants = Array.from(variantSelect.options);
      const matchingVariant = variants.find(option => {
        const variantTitle = option.textContent.trim();
        return selectedOptions.every(selected => variantTitle.includes(selected));
      });
      
      if (matchingVariant) {
        variantSelect.value = matchingVariant.value;
        
        // Update price
        const price = matchingVariant.dataset.price;
        const comparePrice = matchingVariant.dataset.comparePrice;
        const available = matchingVariant.dataset.available === 'true';
        
        // Update add to cart button
        if (available) {
          addToCartButton.disabled = false;
          addToCartButton.textContent = 'Add to Cart';
        } else {
          addToCartButton.disabled = true;
          addToCartButton.textContent = 'Sold Out';
        }
      }
    }
    
    variantInputs.forEach(input => {
      input.addEventListener('change', updateVariant);
    });

    // Wishlist functionality
    const wishlistButton = document.querySelector('.product__wishlist');
    if (wishlistButton) {
      wishlistButton.addEventListener('click', function() {
        // Toggle wishlist state
        this.classList.toggle('active');
        
        // You can implement actual wishlist functionality here
        console.log('Wishlist toggled');
      });
    }
  });
</script>

{% schema %}
{
  "name": "Product Information",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "label": "Show product rating",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_size_guide",
      "label": "Show size guide",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_features",
      "label": "Show product features",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_share_buttons",
      "label": "Show social share buttons",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_related_products",
      "label": "Show related products",
      "default": true
    }
  ]
}
{% endschema %}
